

<img src="D:\文件\大三下\软件工程综合实践\第六次团队作业\系统设计说明书.assets\纸飞机 (大).png" style="zoom: 50%;" />

<center><font size = 6>"纸飞机"系统设计说明书</font></center> 



<center><font size = 5>所属学校：福州大学至诚学院</font></center> 

<center><font size = 5>团队名称：教练喊我们去搬砖</font></center> 

​                                         <font size = 5>指导老师：张栋</font>

















<center> <font size = 5>项目时间：2020-2021第二学期</font></center> 											


<div STYLE="page-break-after: always;"></div>

[TOC]

## 第一章、引言



### 1.1   编写目的



编写本文档的目的主要是详细说明“纸飞机”小程序的系统内部设计，详细说明我们的系统总体设计、功能模块以及接口设计、系统安全性设计，作为我们项目的详细设计说明书，对后续开发起到参考和指导作用。



### 1.2   前景



软件名称：纸飞机 

开发者：福州大学至诚学院计算机系  2018 级  "教练喊我们去搬砖" 

近年来，随着高校招生规模的不断扩大、社会竞争的日益激烈，越来越多的学生为了应付各类考试而不断涌向图书馆看书备考，以提高自己的学习能力。针对想要学习却不够自律的同学的角度出发，鼓励同学们通过去图书馆打卡学习的方式养成学习的习惯。



### 1.3   定义



| **序号** | **缩写**       | **英文全称**                       | **定义**                                                     |
| -------- | -------------- | ---------------------------------- | ------------------------------------------------------------ |
| 1        | 微 信 小 程 序 | Wechat  Mini Program               | 微信小程序是微信提供给商户实现 APP 的一种轻应用，开发起来简单，易用。 |
| 2        | API            | Application  Programming Interface | 应用程序接口是一些预先定义的接口（如函数、HTTP接口）或指软件系统不同组成部分衔接的约定。用来提供应用程序与 开发人员基于某软件或硬件得以访问的一组例程，而又无需访问  源码，或理解内部工作机制的细节。 |

 

### 1.4   参考资料



[概要设计说明书 GB8567--88(系统设计说明书)]( https://wenku.baidu.com/view/5e697d81a8114431b80dd804.html)

[微信开发者官方文档]( https://developers.weixin.qq.com/miniprogram/dev/framework/quickstart/) 

[做一个微信小程序的完整流](https://blog.csdn.net/bryant0917/article/details/82470433 )

[小程序文档整理之——开放接口](https://blog.csdn.net/bobobocai/article/details/77651566 )

 [详解设计模式六大原则](https://www.cnblogs.com/toutou/p/4870926.html)

[小程序开发之数据库备份](https://cloud.tencent.com/developer/article/1519863)



## 第二章、功能模块层次设计



1. 登录模块：

   

   首次使用小程序通过微信授权获取用户信息，绑定学号完善用户信息后，完成登录，之后每次使用小程序调用后端数据库实现永久登录。

   

2. 定位模块：

   

   点击打卡或签退时，调用小程序定位接口获取用户定位授权，在图书馆内则可进行签到或签退。

   

3. 签到（签退）模块：

   

   登录状态下，点击日历图下的打卡按钮，定位成功后完成打卡，点击日历图下签退按钮，定位成功后完成签退，如果用户签到时误点签退或者签退时误点签到，可以根据返回的数据进行相应的错误提示。

   

4. 补签模块：

   

   当日学习超过2小时，可以获得一次补签机会，每个月只能获得三次补签机会，点击补签按钮，只能补签昨日的签到情况，后台修改累计打卡天数和当前连续打卡天数。

   

5. 个人信息模块：

   

   包括用户的个人信息（学号、姓名、系别、专业、入学年份）累计打卡天数、连续打卡天数、累计打卡时长。

   

6. 分享模块：

   

   打卡或签退完成后会生成海报，可以将海报进行分享给微信朋友或朋友圈。

   

7. 排行榜模块：

   

   点击打卡排行榜按钮后进入排行榜页面，调用后端数据库，根据所有用户的月累计、学期打卡时长进行排行后，返回到页面。

   

## 第三章、功能模块层次图：



![](D:\文件\大三下\软件工程综合实践\第六次团队作业\功能模块层次图.png)



## 第四章、UML 设计图：



1、类图：



<img src="D:\文件\大三下\软件工程综合实践\第六次团队作业\类图.png" style="zoom:80%;" />



2、活动图：



<img src="D:\文件\大三下\软件工程综合实践\第六次团队作业\活动图.png" style="zoom:80%;" />



3、泳道图：



<img src="D:\文件\大三下\软件工程综合实践\第六次团队作业\泳道图.png" alt="泳道图" style="zoom: 25%;" />



4、状态图：



<img src="D:\文件\大三下\软件工程综合实践\第六次团队作业\状态图.png" alt="状态图" style="zoom: 25%;" />





## 第五章、接口设计



### 5.1  外部接口:



(1) 小程序登录模块与微信后台的接口:

检查登录态是否过期的接口：wx.checkSession

授权接口：wx.getSetting

获取登陆凭证code的接口：wx.login

获取用户信息的接口：wx.getUserInfo



(2) 小程序获取用户地理位置接口:

wx.getSetting({ 

success(res) { 

if (!res.authSetting['scope.userLocation']) { //授权，登录凭证校验。通过 [wx.login](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html) 接口获得临时登录凭证 code 后传到开发者服务器调用此接口完成登录流程。

wx.authorize({ 

scope: 'scope.userLocation', 

success () { 

// 用户已经同意小程序使用定位，后续调用 wx.getLocation 接口不会弹窗询问 

wx.getLocation({ 

type: 'wgs84', 

success (res) { 

//获取用户的地理位置 

const latitude = res.latitude  //获取经度

const longitude = res.longitude //获取纬度

const speed = res.speed //获取速度

const accuracy = res.accuracy  //获取高度

}})}})}}}) 



### 5.2  内部接口：



(1)

登陆验证接口：

login.jsp //JSP实现用户登录验证

check.jsp //JSP实现session会话维持

| 参数名   | 类型   | 长度    | 备注         |
| -------- | ------ | ------- | ------------ |
| UserId   | String | 255字节 | 登陆账户     |
| password | String | 255字节 | 登陆密码     |
| Session  | String | 255字节 | 保持登录状态 |

如果账户密码正确且会话维持码正确返回111，如果用户存在但还是会话维持码不正确返回112，如果用户不存在则返回 113



(2)

日历签到功能接口:signin.js

当前信息(经纬度):data：{...}

获取地理位置(经纬度)：getLocation()

是否可以签到：activeSign()

已签到过：alreadySign()

已签到日期：yesdate()

日历图 dateInit ： function (setYear, setMonth)

日历图上下月切换：lastMonth: function ()、nextMonth: function ()

页面监听：onLoad: function (options)

点击右上角分享：onShareAppMessage: function ()



## 第六章、数据库设计



### 6.1  数据库模型



6.1.1  概念结构模型

用户(学生ID、学生学号、学生姓名、系别、专业、年级) 

 ![image-20210502202622387](D:\文件\大三下\软件工程综合实践\第六次团队作业\系统设计说明书.assets\image-20210502202622387.png)                            

打卡信息(学生ID、学生学号、累计打卡天数、签到时间戳、签退时间戳、连续天数判断、累计小时数、当天小时数、连续打卡天数)

 ![image-20210502202634006](D:\文件\大三下\软件工程综合实践\第六次团队作业\系统设计说明书.assets\image-20210502202634006.png)

时长排行榜(学生ID、学生学号、学期时长、当月时长、当前月份)

![image-20210502202646977](D:\文件\大三下\软件工程综合实践\第六次团队作业\系统设计说明书.assets\image-20210502202646977.png) 

6.1.2  逻辑结构设计

 ![image-20210502202700868](D:\文件\大三下\软件工程综合实践\第六次团队作业\系统设计说明书.assets\image-20210502202700868.png)

 

6.1.3  物理结构设计



用户表

 ![image-20210502202712997](D:\文件\大三下\软件工程综合实践\第六次团队作业\系统设计说明书.assets\image-20210502202712997.png)

打卡信息表

 ![image-20210502202721788](D:\文件\大三下\软件工程综合实践\第六次团队作业\系统设计说明书.assets\image-20210502202721788.png)

排行时长榜表

 ![image-20210502202728657](D:\文件\大三下\软件工程综合实践\第六次团队作业\系统设计说明书.assets\image-20210502202728657.png)

 

### 6.2  ER分析、表结构设计 

 ![image-20210502202735942](D:\文件\大三下\软件工程综合实践\第六次团队作业\系统设计说明书.assets\image-20210502202735942.png)

用户表记录学生学号、姓名和联系方式等基本信息

User的结构

 ![image-20210502202743327](D:\文件\大三下\软件工程综合实践\第六次团队作业\系统设计说明书.assets\image-20210502202743327.png)

打卡信息表记录学生关于签到记录的相关信息

Click_Info的结构

 ![image-20210502202749017](D:\文件\大三下\软件工程综合实践\第六次团队作业\系统设计说明书.assets\image-20210502202749017.png)

排行时长榜表记录学生月份签到时长以及学期时长等基本信息

Ranking_duration_list的结构

 ![image-20210502202754327](D:\文件\大三下\软件工程综合实践\第六次团队作业\系统设计说明书.assets\image-20210502202754327.png)



## 第七章、系统安全和权限设计



### 7.1  系统安全设计原则



由于在网络环境下，任何用户对任何资源包括硬件和软件资源的共享，所以必须通过制定相应的安全策略来防止非法访问者访问数据资源，对数据资源的存储以及传输进行安全性保护。



7.1.1  标识与确认信息



用户在访问小程序资源时，必须得到系统的身份认证以及身份标识，如学号、姓名、系别、专业等。当用户信息与数据库中的学生信息一致时，才能获准访问小程序。



7.1.2  授权



对用户授予访问小程序页面资源的权限，例如打卡，浏览排行榜、查看个人信息，日历图的签到补签等功能。



### 7.2  系统级安全



系统级安全主要体现系统软件平台的安全设置上。



7.2.1 操作系统平台的安全管理



保证学生用户对数据库的数据文件不能有可写、可删除的权限，以保证数据库的数据信息不会被随意篡改导致其他用户信息出错。



7.2.2 数据库系统的安全管理



数据库系统是整个系统的核心，是所有业务管理数据以及清算数据等数据存放的中心。数据库的安全直接关系到整个系统的安全。通过区分不同的访问者、不同的访问类型和不同的数据对象，进行分别对待而获得的数据库安全保密设计，考虑如下：

（1）数据库由专门数据库管理员对数据库操作。管理员权限最大，可以控制所有数据，同时，数据库的密码应由专人负责，密码应该定期变换。

（2）小程序连接数据库的用户绝对不能使用及修改数据库，必须对其进行严格的权限管理，控制对数据库中每个对象的读写权限。

（3）利用数据库的审计功能，以对用户的某些操作进行记录。充分使用视图以及存储过程，保护基础数据表。



### 7.3  应用级安全



针对本小程序，我们在考虑其应用级安全时，主要针对系统的用户授权及安全访问控制 。



7.3.1用户授权及安全访问控制



用户只有一种进行学生认证成功的学生用户。 

通过学生认证的学生用户在不违背系统规则情况下可以使用小程序页面的所有功能。

对系统的使用范围包括一个时间范围：及早上八点到晚上九点期间才能使用系统，其他时间系统都处于停止服务状态。

·用户认证 

使用小程序的主体在进行身份认证时，需要提供学生信息和身份信息。只有正确符合学生和身份信息的用户才会被允许登录

·用户授权

给学生用户授予访问资源的权限：

![img](file:///C:/Users/YYY/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg)



### 7.4  权限管理



权限管理是用户进行系统权限划分和设置的平台，按照管理的层次可划分为两个层面进行管理，管理员和学生用户。



7.4.1 管理员



管理员权限最大，可以控制数据库的修改及使用还有小程序的所有数据。



7.4.2 学生用户



学生用户权限低于管理员，没有操作数据库的权限，只能使用小程序已有的定位，打卡，分享等功能模块。



 